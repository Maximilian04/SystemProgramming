Turbo Assembler	 Version 4.1	    03/07/23 16:13:34	    Page 1
reghunt.asm



      1	0000			     .model tiny
      2	0000			     .code
      3				     .286
      4				     locals @@
      5				     org 100h
      6
      7	0100  EB 58 90		     Start:	     jmp Main
      8
      9	0103  00		     State:	     db	0h
     10
     11
     12				     ;------------------------------------------------
     13				     ; Keyboard	intterupt handler
     14				     ;------------------------------------------------
     15				     ;
     16				     ;	 Catches control keys &	sets (State) variable
     17				     ;
     18				     ;------------------------------------------------
     19
     20	0104			     New09Int	     proc
     21	0104  50 53 06				     push ax bx	es	     ; Stored regs
     22
     23	0107  E4 60				     in	al, 60h		     ; Catch key code
     24
     25	0109  3C 1D				     cmp al, 01Dh
     26	010B  74 07				     je	@@ControlKey1
     27	010D  3C 9D				     cmp al, 09Dh
     28	010F  74 0B				     je	@@ControlKey2
     29
     30	0111  EB 0C 90				     jmp @@NotControlKey
     31	0114					 @@ControlKey1:
     32									     ; Invert State variable
     33						     ; inc byte	ptr [State]
     34	0114  80 36 0103r 01			     xor byte ptr [State], 01b
     35
     36	0119  EB 04 90				     jmp @@NotControlKey
     37	011C					 @@ControlKey2:
     38									     ; Invert State variable
     39						     ; mov byte	ptr [State], 00b
     40
     41	011C  EB 01 90				     jmp @@NotControlKey
     42	011F					 @@NotControlKey:
     43
     44	011F  E4 61				     in	al, 61h		     ; Set interruptor free
     45	0121  0C 80				     or	al, 80h
     46	0123  E6 61				     out 61h, al
     47	0125  24 7F				     and al, not 80h
     48	0127  E6 61				     out 61h, al
     49
     50	0129  B0 20				     mov al, 20h	     ; Set interruptor free
     51	012B  E6 20				     out 20h, al
     52
     53
     54	012D  07 5B 58				     pop es bx ax	     ; Stored regs
     55	0130  9C				     pushf
     56	0131  9A				     db	09Ah		     ; CALL FAR
     57	0132  0000		     Old09Ofs	     dw	0		     ; call old	09 interruption
Turbo Assembler	 Version 4.1	    03/07/23 16:13:34	    Page 2
reghunt.asm



     58	0134  0000		     Old09Seg	     dw	0
     59
     60	0136  CF				     iret
     61	0137					     endp
     62
     63				     ;------------------------------------------------
     64				     ;------------------------------------------------
     65
     66
     67				     ;------------------------------------------------
     68				     ; Timer intterupt handler
     69				     ;------------------------------------------------
     70				     ;
     71				     ;	 Draws
     72				     ;
     73				     ;------------------------------------------------
     74
     75	0137			     New08Int	     proc
     76	0137  50 53 06				     push ax bx	es	     ; Stored regs
     77
     78
     79	013A  BB B800				     mov bx, 0b800h
     80	013D  8E C3				     mov es, bx
     81	013F  BB 00C8				     mov bx, 200d
     82
     83	0142  A0 0103r				     mov al, byte ptr [State]
     84	0145  26: 88 07				     mov byte ptr es:[bx], al
     85
     86	0148  80 3E 0103r 01			     cmp byte ptr [State], 01b
     87	014D  75 03				     jne @@DoNotDraw
     88
     89						     ; mov byte	ptr es:[bx], 61d
     90
     91	014F  EB 01 90				     jmp @@DoNotDrawEnd
     92	0152					 @@DoNotDraw:
     93
     94						     ; mov byte	ptr es:[bx], 62d
     95
     96	0152					 @@DoNotDrawEnd:
     97						     ; in al, 61h	       ; Set interruptor free
     98						     ; or al, 80h
     99						     ; out 61h,	al
    100						     ; and al, not 80h
    101						     ; out 61h,	al
    102
    103	0152  B0 20				     mov al, 20h	     ; Set interruptor free
    104	0154  E6 20				     out 20h, al
    105
    106	0156  07 5B 58				     pop es bx ax	     ; Stored regs
    107
    108
    109						     ; pushf
    110						     ; db 09Ah		       ; CALL FAR
    111				     ; Old08Ofs	       dw 0		       ; call old 08 interruption
    112				     ; Old08Seg	       dw 0
    113
    114	0159  CF				     iret
Turbo Assembler	 Version 4.1	    03/07/23 16:13:34	    Page 3
reghunt.asm



    115	015A					     endp
    116
    117	015A			     InterruptorMemEnd:
    118
    119				     ;------------------------------------------------
    120				     ;------------------------------------------------
    121
    122
    123	015A			     Main:
    124	015A  FA				     cli
    125	015B  BB 0000				     mov bx, 0
    126	015E  8E C3				     mov es, bx
    127	0160  BB 0024				     mov bx, 9*4			 ; DOS interruption address offset
    128
    129	0163  26: 8B 07				     mov ax, es:[bx]			 ; Old interrupt-09 handler
    130	0166  A3 0132r				     mov Old09Ofs, ax
    131	0169  26: 8B 47	02			     mov ax, es:[bx+2]
    132	016D  A3 0134r				     mov Old09Seg, ax
    133
    134	0170  26: C7 07	0104r			     mov es:[bx], offset New09Int	 ; Set my interrupt-09 handler
    135	0175  8C C8				     mov ax, cs
    136	0177  26: 89 47	02			     mov es:[bx+2], ax
    137
    138
    139	017B  BB 0020				     mov bx, 8*4			 ; DOS interruption address offset
    140
    141	017E  26: C7 07	0137r			     mov es:[bx], offset New08Int	 ; Set my interrupt-08 handler
    142	0183  8C C8				     mov ax, cs
    143	0185  26: 89 47	02			     mov es:[bx+2], ax
    144	0189  FB				     sti
    145
    146	018A  B8 3100				     mov ax, 3100h
    147	018D  BA 015Ar				     mov dx, offset InterruptorMemEnd	 ; Размер	необходимой	    +
    148				     памяти
    149	0190  C1 EA 04				     shr dx, 4				 ; В параграфе 16 байт
    150	0193  42				     inc dx				 ; С округлением вверх
    151
    152	0194  CD 21				     int 21h
    153
    154				     end	     Start
Turbo Assembler	 Version 4.1	    03/07/23 16:13:34	    Page 4
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "03/07/23"
??FILENAME			  Text	 "reghunt "
??TIME				  Text	 "16:13:34"
??VERSION			  Number 040A
@32BIT				  Text	 0
@@CONTROLKEY1			  Near	 DGROUP:0114
@@CONTROLKEY2			  Near	 DGROUP:011C
@@DONOTDRAW			  Near	 DGROUP:0152
@@DONOTDRAWEND			  Near	 DGROUP:0152
@@NOTCONTROLKEY			  Near	 DGROUP:011F
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0707H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 REGHUNT
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
INTERRUPTORMEMEND		  Near	 DGROUP:015A
MAIN				  Near	 DGROUP:015A
NEW08INT			  Near	 DGROUP:0137
NEW09INT			  Near	 DGROUP:0104
OLD09OFS			  Word	 DGROUP:0132
OLD09SEG			  Word	 DGROUP:0134
START				  Near	 DGROUP:0100
STATE				  Near	 DGROUP:0103

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  0196 Word	  Public  CODE
